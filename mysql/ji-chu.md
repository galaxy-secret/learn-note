# mysql 查询执行的基础

![](/assets/mysql查询执行的基础.png)




### 语法解析器和预处理

** 解析器 **处理语法和解析查询, 生成一课对应的 "解析树". ---> mysql 语法层面 .

** 预处理器 ** 进一步检查解析树的合法性. 如: 数据表和数据列 是否存在, 别名是否有歧义等, 还会进行权限认证.

### 查询优化器

将 解析树 转换为 执行计划.
    
    一条查询可以有多种执行方式, 都会返回同样的结果. 优化器的作用就是找到最好的执行计划.
    (当然也有可能做出最差的决定)
    
mysql 是基于成本的优化器, 其尝试预测一个查询使用某种执行计划是的成本, 并选择其中最小的那个.
    
导致 mysql 优化器选择错误的执行计划的原因.

    * 统计信息不准确. ---> 如InnoDB 是不能提供准确的数据行数的.
    
    * 执行计划中的成本估算不等同于实际执行的成本. 因为执行计划的成本 本来就是 "估算的".
    
    * 优化器的"最优", 和你的"最优" 可能不一样. 一般希望的都是执行时间尽可能的短 = 最优. 但优化器不一定这么认为.
    
    * 不会考虑并发查询的情况.
     
    * 有时候也不会去做基于成本的优化. 一些固定规则: 全文索引的 MATCH()字句. 如果相关列使用了全文索引,
    即是 使用别的索引 + where条件会快很多, 可 mysql 还是会使用 全文索引.
    
    * 不会考虑 存储过程 和 用户自定义函数 的成本. 
    
    * 有时候, 可能无法算出所有的可能的执行计划. 所有有可能错过最优的执行计划.(多表的关联查询等)


